<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Album Cover Mosaic Builder</title>
    <script>
        // Device detection and automatic redirect with resize handling
        (function() {
            // Check URL parameters first (for testing)
            const urlParams = new URLSearchParams(window.location.search);
            const forceMobile = urlParams.get('mobile') === 'true';
            const forceDesktop = urlParams.get('desktop') === 'true';
            
            if (forceMobile) {
                window.location.href = '/mobile/';
                return;
            }
            
            if (forceDesktop) {
                window.location.href = '/desktop.html';
                return;
            }

            // Breakpoint threshold
            const BREAKPOINT = 1024;
            
            // Check if device is actually a mobile device (by user agent)
            function isRealMobileDevice() {
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent.toLowerCase());
            }
            
            // Detect if should use desktop view based on window width
            function shouldUseDesktop() {
                // Real mobile devices always stay on mobile
                if (isRealMobileDevice()) {
                    return false;
                }
                // Desktop browsers switch based on window width
                return window.innerWidth >= BREAKPOINT;
            }
            
            // Get current page type
            function getCurrentPageType() {
                const path = window.location.pathname;
                if (path.includes('/desktop.html') || path.includes('/desktop')) {
                    return 'desktop';
                } else if (path.includes('/mobile/') || path.includes('/mobile')) {
                    return 'mobile';
                }
                return 'index'; // On index page
            }
            
            // Perform redirect if needed
            function redirectIfNeeded() {
                const shouldDesktop = shouldUseDesktop();
                const currentPage = getCurrentPageType();
                
                // Prevent redirect loops - only redirect if not already on correct page
                if (shouldDesktop && currentPage !== 'desktop') {
                    console.log('ðŸ–¥ï¸ Window width >= 1024px, redirecting to desktop...');
                    window.location.href = '/desktop.html';
                } else if (!shouldDesktop && currentPage !== 'mobile') {
                    console.log('ðŸ“± Window width < 1024px, redirecting to mobile...');
                    window.location.href = '/mobile/';
                }
            }
            
            // Initial redirect on page load
            redirectIfNeeded();
            
            // Debounce function to prevent too many redirects
            let resizeTimeout;
            function debounceResize(callback, delay) {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(callback, delay);
            }
            
            // Add resize event listener for dynamic switching
            // Only add if we're on index page (not already redirected)
            if (getCurrentPageType() === 'index') {
                window.addEventListener('resize', function() {
                    console.log(`ðŸ“ Window resized to ${window.innerWidth}px, checking...`);
                    debounceResize(function() {
                        // Check if we need to redirect
                        const shouldDesktop = shouldUseDesktop();
                        const currentPage = getCurrentPageType();
                        
                        console.log(`ðŸ” Should desktop: ${shouldDesktop}, Current page: ${currentPage}, Width: ${window.innerWidth}px`);
                        
                        // Only redirect if crossing the threshold
                        if (shouldDesktop && currentPage !== 'desktop') {
                            console.log('ðŸ–¥ï¸ Window resized to >= 1024px, redirecting to desktop...');
                            window.location.href = '/desktop.html';
                        } else if (!shouldDesktop && currentPage !== 'mobile') {
                            console.log('ðŸ“± Window resized to < 1024px, redirecting to mobile...');
                            window.location.href = '/mobile/';
                        }
                    }, 300); // Reduced to 300ms for faster response
                });
            }
        })();
    </script>
</head>
<body>
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
        <div style="text-align: center;">
            <p>Loading...</p>
            <p style="font-size: 14px; color: #666; margin-top: 10px;">Redirecting to the appropriate view...</p>
        </div>
    </div>
</body>
</html>
