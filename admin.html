<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Edit Content</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace;
            background: #FFF4E6;
            min-height: 100vh;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        html {
            overflow-x: hidden;
        }

        .admin-header {
            text-align: center;
            padding: 15px;
            background: #2d5016;
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .admin-header h1 {
            font-size: 20px;
            color: white;
            margin-bottom: 5px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .tab-btn {
            padding: 8px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            font-family: inherit;
        }

        .tab-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .tab-btn.active {
            background: white;
            color: #2d5016;
            border-color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .main-container {
            display: flex;
            height: calc(100vh - 80px);
            max-width: 100vw;
            overflow-x: hidden;
            margin: 0 auto;
        }

        /* Left Panel - Empty placeholder for admin */
        .viewer-panel {
            flex: 1;
            min-width: 0;
            background: #FFFBF5;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 16px;
        }

        /* Right Panel - Controls */
        .control-panel {
            flex: 1;
            min-width: 0;
            background: #FFFBF5;
            padding: 40px;
            overflow-y: auto;
            overflow-x: hidden;
            border-left: 1px solid #e0e0e0;
        }

        .title {
            font-size: 32px;
            font-weight: normal;
            margin-bottom: 10px;
            color: #E87D3E;
            font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace;
        }

        .price {
            font-size: 20px;
            color: #333333;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
            font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-label {
            font-size: 13px;
            font-weight: normal;
            color: #FF6B35;
            margin-bottom: 12px;
            text-transform: none;
            letter-spacing: 0;
            font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace;
        }
        
        .section-label[contenteditable="true"]:hover {
            background-color: rgba(255, 107, 53, 0.1);
        }
        
        .section-label[contenteditable="true"]:focus {
            outline: 2px solid #FF6B35;
            outline-offset: 2px;
            background-color: rgba(255, 107, 53, 0.15);
        }
        
        #admin-panel-title-preview:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        #admin-panel-title-preview:focus {
            outline: 2px solid #333;
            outline-offset: 2px;
            background-color: rgba(0, 0, 0, 0.1);
        }
        
        #admin-canvas-label-preview:hover {
            background-color: rgba(232, 125, 62, 0.1);
        }
        
        #admin-canvas-label-preview:focus {
            outline: 2px solid #E87D3E;
            outline-offset: 2px;
            background-color: rgba(232, 125, 62, 0.15);
        }

        .color-palette {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
        }

        .color-swatch {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        .color-swatch.selected {
            border: 3px solid #333333;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #333333;
        }

        /* Hover states for all contenteditable elements */
        [contenteditable="true"]:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        [contenteditable="true"]:focus {
            outline: 2px solid #2d5016;
            outline-offset: 2px;
            background-color: rgba(45, 80, 22, 0.1);
        }

        .grid-btn[contenteditable="true"]:hover {
            background-color: #d0d0d0;
        }

        .grid-btn[contenteditable="true"]:focus {
            outline: 2px solid #2d5016;
            outline-offset: 2px;
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
            margin-bottom: 15px;
        }

        .upload-area:hover {
            border-color: #999;
            background: #f5f5f5;
        }

        .upload-icon {
            font-size: 40px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .upload-text {
            font-size: 14px;
            color: #333333;
            margin-bottom: 5px;
            font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace;
        }

        .upload-subtext {
            font-size: 12px;
            color: #333333;
            font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace;
        }

        .file-input {
            display: none;
        }

        .grid-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .grid-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid #333333;
            background: #E0E0E0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: normal;
            color: #333333;
            transition: all 0.2s;
            font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace;
        }

        .grid-btn.active {
            background: #333333;
            color: #FFFFFF;
            border-color: #333333;
        }

        .grid-btn:hover:not(.active) {
            background: #d0d0d0;
        }

        .slider-control {
            margin-bottom: 20px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: normal;
            color: #333333;
            font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: black;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: black;
            cursor: pointer;
            border: none;
        }

        .info-box {
            background: transparent;
            border: none;
            padding: 20px 0;
            margin-top: 20px;
        }

        .editable-text {
            width: 100%;
            padding: 8px;
            border: 2px solid transparent;
            border-radius: 4px;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            color: inherit;
            font-weight: inherit;
            transition: all 0.2s;
        }

        .editable-text:focus {
            outline: none;
            border-color: #2d5016;
            background: rgba(45, 80, 22, 0.05);
        }

        .editable-textarea {
            width: 100%;
            padding: 8px;
            border: 2px solid transparent;
            border-radius: 4px;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            color: inherit;
            resize: vertical;
            min-height: 60px;
            transition: all 0.2s;
        }

        .editable-textarea:focus {
            outline: none;
            border-color: #2d5016;
            background: rgba(45, 80, 22, 0.05);
        }

        .main-price-input {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            width: 100%;
            font-family: inherit;
            margin-bottom: 10px;
        }

        .main-price-input:focus {
            outline: none;
            border-color: #2d5016;
        }

        .price-details {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .price-detail-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .price-detail-label {
            font-size: 12px;
            color: #666;
            min-width: 80px;
        }

        .price-detail-input {
            font-size: 12px;
            color: #333;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
            font-family: inherit;
        }

        .price-detail-input:focus {
            outline: none;
            border-color: #2d5016;
        }

        .stand-section, .addons-section {
            margin-top: 20px;
        }

        .stand-item, .addon-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 6px;
        }

        .item-left {
            display: flex;
            align-items: center;
            flex: 1;
            gap: 12px;
        }

        .item-image {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }

        .item-price-input {
            font-size: 12px;
            color: #666;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 80px;
            font-family: inherit;
        }

        .item-price-input:focus {
            outline: none;
            border-color: #2d5016;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            border-radius: 24px;
            transition: .4s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            border-radius: 50%;
            transition: .4s;
        }

        input:checked + .toggle-slider {
            background-color: #2d5016;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .image-upload-btn {
            padding: 6px 12px;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-family: inherit;
            margin-right: 10px;
        }

        .image-upload-btn:hover {
            background: #555;
        }

        .stl-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }

        .stl-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .stl-item:last-child {
            margin-bottom: 0;
        }

        .stl-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            min-width: 80px;
        }

        .stl-upload-btn {
            padding: 8px 16px;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-family: inherit;
        }

        .stl-upload-btn:hover {
            background: #555;
        }

        .stl-status {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }

        .save-all-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 24px;
            background: #2d5016;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            font-family: inherit;
        }

        .save-all-button:hover {
            background: #1f3a0f;
        }

        .save-all-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status-message {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 6px;
            display: none;
            font-size: 14px;
            z-index: 1001;
            font-family: inherit;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        /* Orders Tab Styles */
        .order-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .order-id {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .order-date {
            color: #666;
            font-size: 12px;
        }

        .order-price {
            font-size: 20px;
            font-weight: 600;
            color: #2d5016;
        }

        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .order-detail-item {
            display: flex;
            flex-direction: column;
        }

        .order-detail-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .order-detail-value {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .order-addons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .addon-badge {
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: #333;
        }

        .order-files {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .file-download-btn {
            padding: 8px 16px;
            background: #2d5016;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s;
        }

        .file-download-btn:hover {
            background: #1f3510;
        }

        .delete-order-btn {
            padding: 6px 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .delete-order-btn:hover {
            background: #c82333;
        }

        .order-select-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin-right: 10px;
        }

        .bulk-actions {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .select-all-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .select-all-container label {
            cursor: pointer;
            font-size: 14px;
            user-select: none;
        }

        .delete-selected-btn {
            padding: 10px 20px;
            background: #2d5016;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
        }

        .delete-selected-btn:hover {
            background: #1f3a0f;
        }

        .delete-selected-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .mark-completed-btn {
            padding: 10px 20px;
            background: #2d5016;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
        }

        .mark-completed-btn:hover {
            background: #1f3a0f;
        }

        .mark-completed-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }

            .control-panel {
                width: 100%;
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <h1>Admin Panel</h1>
        <div class="admin-tabs">
            <button class="tab-btn active" onclick="showTab('edit')">Edit</button>
            <button class="tab-btn" onclick="showTab('orders')">Orders</button>
        </div>
    </div>

    <!-- Edit Tab -->
    <div id="edit-tab" class="tab-content active">
        <div class="main-container">
            <!-- Left Panel - Preview of Editor Panel -->
            <div class="viewer-panel" style="padding: 20px; align-items: flex-start;">
                <div style="width: 100%; max-width: 600px;">
                    <h2 class="panel-title" id="admin-panel-title-preview" contenteditable="true" style="font-size: 24px; font-weight: normal; color: #333; margin-bottom: 20px; padding: 8px; border: 2px solid transparent; border-radius: 4px; cursor: text; transition: all 0.2s;">Edit Your Photo</h2>
                    <div style="margin-top: 12px;">
                        <div class="canvas-label" id="admin-canvas-label-preview" contenteditable="true" style="font-size: 17px; font-weight: normal; margin-bottom: 10px; color: #E87D3E; font-family: 'Courier New', Courier, 'Lucida Console', Monaco, monospace; padding: 4px 8px; border: 2px solid transparent; border-radius: 4px; cursor: text; transition: all 0.2s; display: none;">Processed (Posterized)</div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Controls -->
            <div class="control-panel">
                <h1 class="title">
                    <input type="text" class="editable-text" id="admin-title" value="3D Album Cover Mosaic Builder" style="font-size: 32px; font-weight: normal; color: #E87D3E; width: 100%; padding: 0; border: 2px solid transparent; background: transparent;">
                </h1>
                <div class="price">
                    <input type="text" class="editable-text" id="admin-price-subtitle" value="Create colorized 3D prints" style="font-size: 20px; color: #333333; width: 100%; padding: 0; border: 2px solid transparent; background: transparent;">
                </div>

                <!-- Upload PNG -->
                <div class="section">
                    <div class="section-label" id="admin-section-upload" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block; min-width: 150px;">1. Upload Color Image</div>
                    <div class="upload-area">
                        <div class="upload-icon">üñºÔ∏è</div>
                        <input type="text" class="editable-text upload-text" id="admin-upload-text" value="Choose image file..." style="text-align: center;">
                        <input type="text" class="editable-text upload-subtext" id="admin-upload-subtext" value="Will be resized to 75√ó75 pixels" style="text-align: center;">
                    </div>
                </div>

                <!-- Grid Size -->
                <div class="section">
                    <div class="section-label" id="admin-section-grid" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block; min-width: 150px;">2. Select Grid Size</div>
                    <div class="grid-options">
                        <button class="grid-btn" data-size="48" id="admin-grid-btn-48" contenteditable="true" style="cursor: text; padding: 12px; border: 1px solid #333333; background: #E0E0E0; border-radius: 6px; font-size: 14px; font-weight: normal; color: #333333; transition: all 0.2s;">48 √ó 48</button>
                        <button class="grid-btn active" data-size="75" id="admin-grid-btn-75" contenteditable="true" style="cursor: text; padding: 12px; border: 1px solid #333333; background: #E0E0E0; border-radius: 6px; font-size: 14px; font-weight: normal; color: #333333; transition: all 0.2s;">75 √ó 75</button>
                        <button class="grid-btn" data-size="96" id="admin-grid-btn-96" contenteditable="true" style="cursor: text; padding: 12px; border: 1px solid #333333; background: #E0E0E0; border-radius: 6px; font-size: 14px; font-weight: normal; color: #333333; transition: all 0.2s;">96 √ó 96</button>
                    </div>
                </div>

                <!-- Size Guide Editor -->
                <div class="section" style="background: #f0f8ff; border: 2px solid #2d5016; border-radius: 8px; padding: 20px; margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; font-size: 20px; color: #2d5016; font-weight: bold;">üìè Size Guide Editor</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; font-weight: 600;">Size Guide Title:</label>
                        <input type="text" id="admin-size-guide-title" value="Size Guide" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; font-weight: 600;">Size Guide Button Text:</label>
                        <input type="text" id="admin-size-guide-button-text" value="Size Guide" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-size: 14px; font-weight: 600;">Note (appears at bottom):</label>
                        <input type="text" id="admin-size-guide-note" value="* Unframed baseplate. All other measurements shown are for the framed baseplate." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 6px; border: 1px solid #ccc;">
                        <h4 style="margin-bottom: 10px; font-size: 16px; color: #333;">Square Sizes:</h4>
                        <div id="admin-size-guide-square" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        <button onclick="addSizeGuideItem('square')" style="margin-top: 10px; padding: 8px 16px; background: #2d5016; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 600;">+ Add Square Size</button>
                    </div>
                </div>

                <!-- Image Adjustments -->
                <div class="section">
                    <div class="section-label" id="admin-section-adjustments" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block; min-width: 150px;">Image Adjustments</div>
                    <div class="slider-control">
                        <div class="slider-label">
                            <span id="admin-slider-contrast-label" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">Contrast</span>
                            <span>1.2</span>
                        </div>
                    </div>
                    <div class="slider-control">
                        <div class="slider-label">
                            <span id="admin-slider-brightness-label" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">Brightness</span>
                            <span>1.0</span>
                        </div>
                    </div>
                    <div class="slider-control">
                        <div class="slider-label">
                            <span id="admin-slider-tones-label" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">Tones</span>
                            <span>4</span>
                        </div>
                    </div>
                    <div class="slider-control">
                        <div class="slider-label">
                            <span id="admin-slider-denoise-label" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">Denoise</span>
                            <span>1</span>
                        </div>
                    </div>
                </div>

                <!-- Painting -->
                <div class="section">
                    <div class="section-label" id="admin-section-painting" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block; min-width: 150px;">Painting</div>
                    <div class="color-palette">
                        <div class="color-swatch selected" data-color="0,0,0" style="background: rgb(0,0,0); position: relative;">
                            <span id="admin-color-black-title" contenteditable="true" style="position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 10px; color: #333; cursor: text; padding: 2px; border-radius: 2px; white-space: nowrap;">Black</span>
                        </div>
                        <div class="color-swatch" data-color="85,85,85" style="background: rgb(85,85,85); position: relative;">
                            <span id="admin-color-darkgray-title" contenteditable="true" style="position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 10px; color: #333; cursor: text; padding: 2px; border-radius: 2px; white-space: nowrap;">Dark Gray</span>
                        </div>
                        <div class="color-swatch" data-color="170,170,170" style="background: rgb(170,170,170); position: relative;">
                            <span id="admin-color-lightgray-title" contenteditable="true" style="position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 10px; color: #333; cursor: text; padding: 2px; border-radius: 2px; white-space: nowrap;">Light Gray</span>
                        </div>
                        <div class="color-swatch" data-color="255,255,255" style="background: rgb(255,255,255); position: relative;">
                            <span id="admin-color-white-title" contenteditable="true" style="position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); font-size: 10px; color: #333; cursor: text; padding: 2px; border-radius: 2px; white-space: nowrap;">White</span>
                        </div>
                    </div>
                </div>

                <!-- Price Display Section -->
                <div class="section" id="price-display-section" style="margin-top: 30px;">
                    <div style="margin-bottom: 15px;">
                        <input type="number" step="0.01" min="0" id="admin-main-price" class="main-price-input" value="49.99">
                        <div class="price-details">
                            <div class="price-detail-row">
                                <span class="price-detail-label" id="admin-label-dimensions" contenteditable="true" style="cursor: text; padding: 1px 3px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">Dimensions:</span>
                                <input type="text" class="price-detail-input" id="admin-dimensions" value="75 √ó 75" readonly>
                            </div>
                            <div class="price-detail-row">
                                <span class="price-detail-label" id="admin-label-addons" contenteditable="true" style="cursor: text; padding: 1px 3px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">Addons:</span>
                                <input type="text" class="price-detail-input" id="admin-addons" value="None" readonly>
                            </div>
                        </div>
                    </div>

                    <!-- Grid Size Prices -->
                    <div style="margin-top: 15px;">
                        <div class="price-detail-row">
                            <span class="price-detail-label" id="admin-label-48x48" contenteditable="true" style="cursor: text; padding: 1px 3px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">48√ó48:</span>
                            <input type="number" step="0.01" min="0" id="admin-price-48x48" class="price-detail-input" value="39.99">
                        </div>
                        <div class="price-detail-row">
                            <span class="price-detail-label" id="admin-label-75x75" contenteditable="true" style="cursor: text; padding: 1px 3px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">75√ó75:</span>
                            <input type="number" step="0.01" min="0" id="admin-price-75x75" class="price-detail-input" value="49.99">
                        </div>
                        <div class="price-detail-row">
                            <span class="price-detail-label" id="admin-label-96x96" contenteditable="true" style="cursor: text; padding: 1px 3px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">96√ó96:</span>
                            <input type="number" step="0.01" min="0" id="admin-price-96x96" class="price-detail-input" value="59.99">
                        </div>
                    </div>
                    
                    <!-- Shopify Variant IDs Configuration -->
                    <div style="margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 6px; border: 1px solid #ddd;">
                        <div style="font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                            <span>üîó Shopify Variant IDs</span>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-bottom: 12px;">
                            Configure these in your .env file or environment variables. Prices are fetched from Shopify using these IDs.
                        </div>
                        <div style="margin-bottom: 8px;">
                            <div style="font-size: 13px; font-weight: 500; margin-bottom: 4px;">48√ó48 Variant ID</div>
                            <input type="text" id="admin-variant-48x48" class="variant-id-input" value="" readonly style="background-color: #fff; cursor: not-allowed; width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <div id="admin-variant-48x48-display" style="font-size: 11px; color: #666; margin-top: 2px; font-family: monospace;"></div>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <div style="font-size: 13px; font-weight: 500; margin-bottom: 4px;">75√ó75 Variant ID</div>
                            <input type="text" id="admin-variant-75x75" class="variant-id-input" value="" readonly style="background-color: #fff; cursor: not-allowed; width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <div id="admin-variant-75x75-display" style="font-size: 11px; color: #666; margin-top: 2px; font-family: monospace;"></div>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <div style="font-size: 13px; font-weight: 500; margin-bottom: 4px;">96√ó96 Variant ID</div>
                            <input type="text" id="admin-variant-96x96" class="variant-id-input" value="" readonly style="background-color: #fff; cursor: not-allowed; width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <div id="admin-variant-96x96-display" style="font-size: 11px; color: #666; margin-top: 2px; font-family: monospace;"></div>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <div style="font-size: 13px; font-weight: 500; margin-bottom: 4px;">Display Stand Variant ID</div>
                            <input type="text" id="admin-variant-stand" class="variant-id-input" value="" readonly style="background-color: #fff; cursor: not-allowed; width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <div id="admin-variant-stand-display" style="font-size: 11px; color: #666; margin-top: 2px; font-family: monospace;"></div>
                        </div>
                        <div style="margin-bottom: 8px;">
                            <div style="font-size: 13px; font-weight: 500; margin-bottom: 4px;">Wall Mounting Dots Variant ID</div>
                            <input type="text" id="admin-variant-mounting" class="variant-id-input" value="" readonly style="background-color: #fff; cursor: not-allowed; width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                            <div id="admin-variant-mounting-display" style="font-size: 11px; color: #666; margin-top: 2px; font-family: monospace;"></div>
                        </div>
                    </div>
                    
                    <!-- Stand Toggle -->
                    <div id="stand-section" style="margin-top: 20px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f9f9f9; border-radius: 6px;">
                            <div style="display: flex; align-items: center; flex: 1;">
                                <img id="admin-stand-image" src="" alt="Stand" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; margin-right: 12px; display: none;">
                                <div style="flex: 1;">
                                    <div id="admin-stand-name" contenteditable="true" style="font-size: 14px; font-weight: 500; color: #333; cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">Stand</div>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                                        <button class="image-upload-btn" id="admin-stand-upload-btn" contenteditable="true" onclick="document.getElementById('admin-stand-image-upload').click()" style="cursor: text;">Upload Image</button>
                                        <input type="file" id="admin-stand-image-upload" accept="image/*" onchange="uploadImage('stand', this.files[0])">
                                        <input type="number" step="0.01" min="0" id="admin-stand-price" class="item-price-input" value="10.00">
                                    </div>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="admin-stand-toggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Add-ons Section -->
                    <div id="addons-section" style="margin-top: 20px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: #f9f9f9; border-radius: 6px;">
                            <div style="display: flex; align-items: center; flex: 1;">
                                <img id="admin-mounting-image" src="" alt="Wall Mounting Dots" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; margin-right: 12px; display: none;">
                                <div style="flex: 1;">
                                    <div id="admin-mounting-name" contenteditable="true" style="font-size: 14px; font-weight: 500; color: #333; cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block;">Nano Wall Mounting Dots (Pack of 8)</div>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                                        <button class="image-upload-btn" id="admin-mounting-upload-btn" contenteditable="true" onclick="document.getElementById('admin-mounting-image-upload').click()" style="cursor: text;">Upload Image</button>
                                        <input type="file" id="admin-mounting-image-upload" accept="image/*" onchange="uploadImage('wall_mounting_dots', this.files[0])">
                                        <input type="number" step="0.01" min="0" id="admin-mounting-price" class="item-price-input" value="5.99">
                                    </div>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="admin-mounting-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- STL Upload Section -->
                <div class="section" id="stl-section" style="margin-top: 30px;">
                    <div class="section-label" id="admin-section-stl" contenteditable="true" style="cursor: text; padding: 2px 4px; border-radius: 3px; transition: background-color 0.2s; display: inline-block; min-width: 150px;">STL File Upload</div>
                    <div class="stl-section">
                        <div class="stl-item">
                            <span class="stl-label">48√ó48 STL:</span>
                            <div style="display: flex; align-items: center;">
                                <button class="stl-upload-btn" onclick="document.getElementById('admin-stl-upload-48').click()">Upload STL</button>
                                <input type="file" id="admin-stl-upload-48" accept=".stl" style="display: none;" onchange="uploadSTL(48, this.files[0])">
                                <span class="stl-status" id="admin-stl-status-48x48">No file</span>
                            </div>
                        </div>
                        <div class="stl-item">
                            <span class="stl-label">75√ó75 STL:</span>
                            <div style="display: flex; align-items: center;">
                                <button class="stl-upload-btn" onclick="document.getElementById('admin-stl-upload-75').click()">Upload STL</button>
                                <input type="file" id="admin-stl-upload-75" accept=".stl" style="display: none;" onchange="uploadSTL(75, this.files[0])">
                                <span class="stl-status" id="admin-stl-status-75x75">No file</span>
                            </div>
                        </div>
                        <div class="stl-item">
                            <span class="stl-label">96√ó96 STL:</span>
                            <div style="display: flex; align-items: center;">
                                <button class="stl-upload-btn" onclick="document.getElementById('admin-stl-upload-96').click()">Upload STL</button>
                                <input type="file" id="admin-stl-upload-96" accept=".stl" style="display: none;" onchange="uploadSTL(96, this.files[0])">
                                <span class="stl-status" id="admin-stl-status-96x96">No file</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Info Box (applies to both desktop and mobile) -->
                <div class="info-box" style="background: transparent; border: none; padding: 20px; margin: 20px 0; text-align: left; max-width: 100%; box-sizing: border-box;">
                    <div style="font-size: 12px; color: #999; margin-bottom: 10px; text-align: left;">Info Box Content (Desktop & Mobile)</div>
                    <input type="text" class="editable-text" id="admin-info-title" value="Custom Brick Mosaic Designer" style="font-size: 16px; font-weight: bold; margin-bottom: 15px; text-align: left; width: 100%;">
                    <textarea class="editable-textarea" id="admin-info-description" style="font-size: 14px; line-height: 1.6; color: #666; margin-bottom: 15px; text-align: left; width: 100%;">Turn your favourite photos into stunning brick art‚Äîmade by you!</textarea>
                    <textarea class="editable-textarea" id="admin-info-additional" style="font-size: 14px; line-height: 1.6; color: #666; text-align: left; width: 100%;">Bring your memories to life, one brick at a time. With our Custom Brick Mosaic Designer you can transform any image into a beautiful 3D printable mosaic.</textarea>
                </div>

                <!-- Directions Section -->
                <div style="padding: 20px; margin-top: 20px; background: transparent;">
                    <input type="text" class="editable-text" id="admin-howto-title" value="How to Use" style="font-size: 18px; font-weight: 600; margin-bottom: 20px; color: #333; text-align: left;">
                    <textarea class="editable-textarea" id="admin-howto-content" style="font-size: 14px; line-height: 1.8; color: #666; text-align: left; min-height: 300px; width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit;">1. Upload Your Image
Click the "Upload" button and select a photo from your device. The image will be automatically processed.

2. Adjust Size & Crop
Use the "Size" button to crop your image and choose your grid size (48√ó48, 75√ó75, or 96√ó96). Drag the blue crop box to select the area you want to use.

3. Fine-Tune Adjustments
Click "Adjust" to modify brightness, contrast, and other settings to get the perfect look for your mosaic.

4. Paint & Customize (Optional)
Use the "Paint" button to manually adjust individual colors and add your personal touch to the design.

5. View in 3D
Click "View in 3D" to see your custom brick mosaic come to life. Rotate and zoom to explore your creation.

6. Proceed to Checkout
Once you're happy with your design, click "Proceed to Checkout" to order your custom brick mosaic.</textarea>
                </div>
            </div>
        </div>

        <button class="save-all-button" onclick="saveAll()">Save All</button>
        <div id="status-message" class="status-message"></div>
    </div>

    <!-- Orders Tab -->
    <div id="orders-tab" class="tab-content">
        <div class="control-panel" style="width: 100%; min-width: 100%;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">Orders</h2>
                <button 
                    id="sync-shopify-btn" 
                    onclick="syncWithShopify()" 
                    style="
                        padding: 8px 16px;
                        background: #2d5016;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: 500;
                    "
                    onmouseover="this.style.background='#3a6b1f'"
                    onmouseout="this.style.background='#2d5016'"
                >
                    üîÑ Sync with Shopify
                </button>
            </div>
            <div class="bulk-actions" id="bulk-actions" style="display: none;">
                <div class="select-all-container">
                    <input type="checkbox" id="select-all-orders" onchange="toggleSelectAll(this.checked)">
                    <label for="select-all-orders">Select All</label>
                </div>
                <button class="mark-completed-btn" onclick="markSelectedCompleted(true)" id="mark-completed-btn" disabled>
                    Mark Selected as Completed
                </button>
                <button class="mark-completed-btn" onclick="markSelectedCompleted(false)" id="mark-not-completed-btn" disabled>
                    Mark Selected as Not Completed
                </button>
                <button class="delete-selected-btn" onclick="deleteSelectedOrders()" id="delete-selected-btn" disabled>
                    Delete Selected (<span id="selected-count">0</span>)
                </button>
            </div>
            <div id="orders-list" style="margin-top: 20px;">
                <div id="orders-loading-message" style="padding: 20px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; color: #856404;">
                    <p style="margin-bottom: 10px; font-weight: 600;">‚è≥ Loading orders...</p>
                    <p style="font-size: 14px; line-height: 1.5; margin: 0;">
                        This may take 30-60 seconds, especially on the first load. The server may be starting up (cold start).<br>
                        <strong>Thank you for your patience!</strong>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Backend API URL - Change this to your Flask backend URL
        // For local development: 'http://localhost:5001'
        // For production: Replace with your Render backend URL (e.g., 'https://your-app-name.onrender.com')
        // 
        // TO CONNECT YOUR ADMIN PANEL TO YOUR BACKEND:
        // 1. Deploy server.py to Render.com (or another service)
        // 2. Copy your backend URL from Render dashboard
        // 3. Replace 'YOUR_BACKEND_URL_HERE' below with your actual backend URL
        const BACKEND_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:5003'  // Local development on port 5003
            : 'https://rizepics.onrender.com'; // Backend URL - Render deployment (UPDATE THIS when deploying Supabase backend)
        
        // Check if BACKEND_URL is still the placeholder
        if (BACKEND_URL.includes('YOUR_BACKEND_URL_HERE') || BACKEND_URL.includes('your-backend-url')) {
            console.error('‚ö†Ô∏è BACKEND_URL is not configured! Please update line 1083 in admin.html with your actual backend URL.');
            // Show error on page load
            setTimeout(() => {
                const statusEl = document.getElementById('status-message');
                if (statusEl) {
                    statusEl.className = 'status-message error';
                    statusEl.textContent = '‚ö†Ô∏è ERROR: Backend URL not configured! Deploy server.py to Render.com, then update BACKEND_URL in admin.html (line ~1083) with your Render backend URL. Example: https://your-app-name.onrender.com';
                    statusEl.style.display = 'block';
                }
            }, 500);
        }
        
        // Helper function to get full API URL
        function getApiUrl(path) {
            // Check if BACKEND_URL is still placeholder
            if (BACKEND_URL.includes('YOUR_BACKEND_URL_HERE') || BACKEND_URL.includes('your-backend-url')) {
                showStatus('error', '‚ö†Ô∏è Backend URL not configured! Deploy server.py to Render.com, then update BACKEND_URL in admin.html with your Render backend URL.');
                throw new Error('Backend URL not configured');
            }
            // Remove leading slash if present
            const cleanPath = path.startsWith('/') ? path.substring(1) : path;
            return `${BACKEND_URL}/${cleanPath}`;
        }
        
        let prices = {};
        let productImages = {};
        let textContent = {};
        let orders = [];

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
            
            // Load orders if switching to orders tab
            if (tabName === 'orders') {
                loadOrders();
            }
        }

        // Load orders from API
        async function loadOrders() {
            const ordersList = document.getElementById('orders-list');
            const loadingMessage = document.getElementById('orders-loading-message');
            
            // Show loading message with timeout warning
            let timeoutWarningShown = false;
            const timeoutWarning = setTimeout(() => {
                if (loadingMessage) {
                    timeoutWarningShown = true;
                    loadingMessage.innerHTML = `
                        <p style="margin-bottom: 10px; font-weight: 600;">‚è≥ Still loading orders...</p>
                        <p style="font-size: 14px; line-height: 1.5; margin: 0;">
                            This is taking longer than usual. The server may be experiencing a cold start (30-60 seconds).<br>
                            <strong>Please wait, orders are loading. Thank you for your patience!</strong>
                        </p>
                    `;
                }
            }, 10000); // Show warning after 10 seconds
            
            try {
                // Set a longer timeout for Render free tier (60 seconds)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 60000);
                
                const response = await fetch(getApiUrl('/admin/orders/api'), {
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                clearTimeout(timeoutWarning);
                
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status} ${response.statusText}`);
                }
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`Expected JSON but got ${contentType}. Response: ${text.substring(0, 200)}`);
                }
                orders = await response.json();
                displayOrders();
            } catch (error) {
                clearTimeout(timeoutWarning);
                console.error('Failed to load orders:', error);
                
                if (error.name === 'AbortError') {
                    ordersList.innerHTML = `
                        <div style="padding: 20px; background: #f8d7da; border: 1px solid #dc3545; border-radius: 6px; color: #721c24;">
                            <p style="margin-bottom: 10px; font-weight: 600;">‚è±Ô∏è Request timed out</p>
                            <p style="font-size: 14px; line-height: 1.5; margin: 0;">
                                The server took too long to respond (over 60 seconds). This usually happens on the first request after the server has been idle.<br>
                                <strong>Please try again - the second attempt should be faster!</strong>
                            </p>
                            <button onclick="loadOrders()" style="margin-top: 15px; padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-family: inherit;">
                                Retry Loading Orders
                            </button>
                        </div>
                    `;
                } else {
                    ordersList.innerHTML = `
                        <div style="padding: 20px; background: #f8d7da; border: 1px solid #dc3545; border-radius: 6px; color: #721c24;">
                            <p style="margin-bottom: 10px; font-weight: 600;">‚ùå Failed to load orders</p>
                            <p style="font-size: 14px; line-height: 1.5; margin-bottom: 15px;">${error.message}</p>
                            <button onclick="loadOrders()" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-family: inherit;">
                                Retry Loading Orders
                            </button>
                        </div>
                    `;
                }
            }
        }

        // Sync orders with Shopify
        async function syncWithShopify() {
            const btn = document.getElementById('sync-shopify-btn');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = '‚è≥ Syncing...';
            
            try {
                // Fetch orders from Shopify
                const response = await fetch(getApiUrl('/api/shopify/orders?limit=100'));
                if (!response.ok) {
                    throw new Error(`Failed to fetch Shopify orders: ${response.status}`);
                }
                
                const data = await response.json();
                const shopifyOrders = data.orders || [];
                
                // Merge with local orders
                const localOrders = orders || [];
                const shopifyOrderMap = {};
                
                // Create map of Shopify orders by order_id property
                shopifyOrders.forEach(shopifyOrder => {
                    shopifyOrder.line_items.forEach(item => {
                        item.properties.forEach(prop => {
                            if (prop.name === '_order_id' || prop.name === 'order_id') {
                                shopifyOrderMap[prop.value] = shopifyOrder;
                            }
                        });
                    });
                });
                
                // Update local orders with Shopify data
                localOrders.forEach(order => {
                    const orderId = order.order_id;
                    if (shopifyOrderMap[orderId]) {
                        const shopifyOrder = shopifyOrderMap[orderId];
                        order.shopify_order_id = shopifyOrder.id;
                        order.shopify_order_name = shopifyOrder.name;
                        order.shopify_customer_email = shopifyOrder.email;
                        // Extract customer name
                        const customer = shopifyOrder.customer || {};
                        const customerFirst = customer.first_name || '';
                        const customerLast = customer.last_name || '';
                        if (customerFirst || customerLast) {
                            order.customer_name = `${customerFirst} ${customerLast}`.trim();
                        } else if (shopifyOrder.billing_address && shopifyOrder.billing_address.name) {
                            order.customer_name = shopifyOrder.billing_address.name;
                        }
                        order.shopify_financial_status = shopifyOrder.financial_status;
                        order.shopify_fulfillment_status = shopifyOrder.fulfillment_status;
                        order.shopify_total_price = shopifyOrder.total_price;
                        order.shopify_created_at = shopifyOrder.created_at;
                    }
                });
                
                // Save updated orders
                const saveResponse = await fetch(getApiUrl('/admin/orders/api'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orders)
                });
                
                if (!saveResponse.ok) {
                    throw new Error('Failed to save synced orders');
                }
                
                // Reload orders display
                await loadOrders();
                
                showStatus('success', `‚úÖ Synced ${shopifyOrders.length} Shopify orders`);
            } catch (error) {
                console.error('Error syncing with Shopify:', error);
                showStatus('error', `‚ùå Failed to sync with Shopify: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        // Display orders in the list
        function displayOrders() {
            const ordersList = document.getElementById('orders-list');
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p>No orders yet.</p>';
                document.getElementById('bulk-actions').style.display = 'none';
                return;
            }
            
            // Reset select all checkbox
            document.getElementById('select-all-orders').checked = false;

            ordersList.innerHTML = orders.map(order => {
                const date = new Date(order.timestamp);
                // Fix timezone: server stores UTC, display in local timezone properly
                // Use explicit formatting to avoid timezone confusion
                const formattedDate = date.toLocaleString('en-US', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true,
                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                });
                const isCompleted = order.completed || false;
                
                return `
                    <div class="order-item" style="${isCompleted ? 'opacity: 0.6;' : ''}" data-order-id="${order.order_id}" data-completed="${isCompleted}">
                        <div class="order-header">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <input type="checkbox" 
                                       class="order-select-checkbox" 
                                       data-order-id="${order.order_id}"
                                       onchange="handleOrderCheckboxChange('${order.order_id}', this.checked)">
                                <div>
                                    <div class="order-id">
                                        Order #${order.order_id.substring(0, 8)} 
                                        ${isCompleted ? '<span style="color: #2d5016; font-size: 12px;">‚úì Completed</span>' : ''}
                                        ${order.shopify_order_name ? `<span style="color: #0066cc; font-size: 12px; margin-left: 8px;">üõí ${order.shopify_order_name}</span>` : ''}
                                    </div>
                                    <div class="order-date">${formattedDate}</div>
                                    ${order.customer_name ? `<div style="font-size: 13px; color: #333; margin-top: 4px; font-weight: 500;">üë§ ${order.customer_name}</div>` : ''}
                                    ${order.shopify_customer_email ? `<div style="font-size: 12px; color: #666; margin-top: 4px;">üìß ${order.shopify_customer_email}</div>` : ''}
                                    ${order.shopify_financial_status ? `<div style="font-size: 12px; color: ${order.shopify_financial_status === 'paid' ? '#2d5016' : '#666'}; margin-top: 4px;">üí∞ ${order.shopify_financial_status}</div>` : ''}
                                    ${order.shopify_order_id ? `<div style="font-size: 12px; margin-top: 4px;"><a href="https://${order.shopify_store_url || 'your-store.myshopify.com'}/admin/orders/${order.shopify_order_id}" target="_blank" style="color: #0066cc;">View in Shopify ‚Üí</a></div>` : ''}
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div class="order-price">$${order.total_price.toFixed(2)}</div>
                                <button onclick="deleteOrder('${order.order_id}')" class="delete-order-btn" title="Delete Order">üóëÔ∏è</button>
                            </div>
                        </div>
                        <div class="order-details">
                            <div class="order-detail-item">
                                <span class="order-detail-label">Dimensions</span>
                                <span class="order-detail-value">${order.dimensions}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="order-detail-label">Base Price</span>
                                <span class="order-detail-value">$${order.base_price.toFixed(2)}</span>
                            </div>
                            <div class="order-detail-item">
                                <span class="order-detail-label">Addons</span>
                                <div class="order-addons">
                                    ${order.addons.length > 0 
                                        ? order.addons.map(addon => `<span class="addon-badge">${addon}</span>`).join('')
                                        : '<span class="addon-badge" style="opacity: 0.5;">None</span>'
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="order-files">
                            <a href="${BACKEND_URL}/admin/orders/download/${order.order_id}/model.obj" class="file-download-btn" download>Download OBJ</a>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Update selected count after rendering
            updateSelectedCount();
        }

        // Delete order
        async function deleteOrder(orderId) {
            if (!confirm('Are you sure you want to delete this order? This cannot be undone.')) {
                return;
            }
            
            try {
                const response = await fetch(`/admin/orders/api?order_id=${orderId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('Failed to delete order');
                }
                
                // Reload orders to reflect changes
                loadOrders();
            } catch (error) {
                console.error('Error deleting order:', error);
                alert('Failed to delete order');
            }
        }

        // Handle checkbox change
        function handleOrderCheckboxChange(orderId, checked) {
            updateSelectedCount();
        }

        // Toggle select all orders
        function toggleSelectAll(checked) {
            const checkboxes = document.querySelectorAll('.order-select-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = checked;
            });
            updateSelectedCount();
        }

        // Update selected count and enable/disable buttons
        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.order-select-checkbox:checked');
            const count = checkboxes.length;
            document.getElementById('selected-count').textContent = count;
            const hasSelection = count > 0;
            document.getElementById('delete-selected-btn').disabled = !hasSelection;
            document.getElementById('mark-completed-btn').disabled = !hasSelection;
            document.getElementById('mark-not-completed-btn').disabled = !hasSelection;
            
            // Show/hide bulk actions
            const bulkActions = document.getElementById('bulk-actions');
            const hasOrders = document.querySelectorAll('.order-item').length > 0;
            bulkActions.style.display = hasOrders ? 'flex' : 'none';
        }

        // Mark selected orders as completed or not completed
        async function markSelectedCompleted(completed) {
            const checkboxes = document.querySelectorAll('.order-select-checkbox:checked');
            const selectedIds = Array.from(checkboxes).map(cb => cb.dataset.orderId);
            
            if (selectedIds.length === 0) {
                return;
            }
            
            const count = selectedIds.length;
            const action = completed ? 'mark as completed' : 'mark as not completed';
            
            try {
                for (const orderId of selectedIds) {
                    const response = await fetch(getApiUrl('/admin/orders/api'), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ order_id: orderId, completed: completed })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Failed to update order ${orderId}`);
                    }
                }
                
                await loadOrders();
                alert(`Successfully ${action} ${count} order${count > 1 ? 's' : ''}.`);
            } catch (error) {
                console.error('Error updating orders:', error);
                alert('Failed to update some orders: ' + error.message);
                await loadOrders();
            }
        }

        // Delete all selected orders
        async function deleteSelectedOrders() {
            const checkboxes = document.querySelectorAll('.order-select-checkbox:checked');
            const selectedIds = Array.from(checkboxes).map(cb => cb.dataset.orderId);
            
            if (selectedIds.length === 0) {
                return;
            }
            
            const count = selectedIds.length;
            if (!confirm(`Are you sure you want to delete ${count} order${count > 1 ? 's' : ''}? This cannot be undone.`)) {
                return;
            }
            
            try {
                for (const orderId of selectedIds) {
                    const response = await fetch(getApiUrl(`/admin/orders/api?order_id=${orderId}`), {
                        method: 'DELETE'
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Failed to delete order ${orderId}`);
                    }
                }
                
                await loadOrders();
                alert(`Successfully deleted ${count} order${count > 1 ? 's' : ''}.`);
            } catch (error) {
                console.error('Error deleting orders:', error);
                alert('Failed to delete some orders: ' + error.message);
                await loadOrders();
            }
        }

        async function loadPrices() {
            try {
                const response = await fetch(getApiUrl('/admin/prices/api'));
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status} ${response.statusText}`);
                }
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`Expected JSON but got ${contentType}. Response: ${text.substring(0, 200)}`);
                }
                prices = await response.json();
                populatePrices();
            } catch (error) {
                console.error('Failed to load prices:', error);
                showStatus('error', 'Failed to load prices: ' + error.message);
            }
        }

        async function loadImages() {
            try {
                const response = await fetch(getApiUrl('/admin/images/api'));
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status} ${response.statusText}`);
                }
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`Expected JSON but got ${contentType}. Response: ${text.substring(0, 200)}`);
                }
                productImages = await response.json();
                updateImagePreviews();
            } catch (error) {
                console.error('Failed to load images:', error);
                showStatus('error', 'Failed to load images: ' + error.message);
            }
        }

        async function loadTextContent() {
            try {
                const response = await fetch(getApiUrl('/admin/content/api'));
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status} ${response.statusText}`);
                }
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`Expected JSON but got ${contentType}. Response: ${text.substring(0, 200)}`);
                }
                textContent = await response.json();
                populateText();
            } catch (error) {
                console.error('Failed to load text content:', error);
                showStatus('error', 'Failed to load text content: ' + error.message);
            }
        }

        function populatePrices() {
            if (prices['48x48']) document.getElementById('admin-price-48x48').value = prices['48x48'];
            if (prices['75x75']) {
                document.getElementById('admin-price-75x75').value = prices['75x75'];
                document.getElementById('admin-main-price').value = prices['75x75'];
            }
            if (prices['96x96']) document.getElementById('admin-price-96x96').value = prices['96x96'];
            if (prices.stand) document.getElementById('admin-stand-price').value = prices.stand;
            if (prices.wall_mounting_dots) document.getElementById('admin-mounting-price').value = prices.wall_mounting_dots;
        }
        
        // Load and display Shopify variant IDs
        async function loadVariantIds() {
            try {
                const response = await fetch(getApiUrl('/api/shopify/variants'));
                if (response.ok) {
                    const variants = await response.json();
                    
                    // Populate variant ID fields
                    if (variants.variant_48) {
                        document.getElementById('admin-variant-48x48').value = variants.variant_48;
                        document.getElementById('admin-variant-48x48-display').textContent = variants.variant_48;
                    }
                    if (variants.variant_75) {
                        document.getElementById('admin-variant-75x75').value = variants.variant_75;
                        document.getElementById('admin-variant-75x75-display').textContent = variants.variant_75;
                    }
                    if (variants.variant_96) {
                        document.getElementById('admin-variant-96x96').value = variants.variant_96;
                        document.getElementById('admin-variant-96x96-display').textContent = variants.variant_96;
                    }
                    if (variants.variant_stand) {
                        document.getElementById('admin-variant-stand').value = variants.variant_stand;
                        document.getElementById('admin-variant-stand-display').textContent = variants.variant_stand;
                    }
                    if (variants.variant_mounting) {
                        document.getElementById('admin-variant-mounting').value = variants.variant_mounting;
                        document.getElementById('admin-variant-mounting-display').textContent = variants.variant_mounting;
                    }
                }
            } catch (error) {
                console.error('Failed to load variant IDs:', error);
            }
        }

        function populateText() {
            if (textContent.upload_image_text) document.getElementById('admin-upload-text').value = textContent.upload_image_text;
            if (textContent.upload_subtext) document.getElementById('admin-upload-subtext').value = textContent.upload_subtext;
            // STL upload fields removed from admin panel
            // if (textContent.stl_upload_text) document.getElementById('admin-stl-upload-text').value = textContent.stl_upload_text;
            // if (textContent.stl_subtext) document.getElementById('admin-stl-subtext').value = textContent.stl_subtext;
            if (textContent.info_title) document.getElementById('admin-info-title').value = textContent.info_title;
            if (textContent.info_description) document.getElementById('admin-info-description').value = textContent.info_description;
            if (textContent.info_additional) document.getElementById('admin-info-additional').value = textContent.info_additional;
            if (textContent.howto_title) document.getElementById('admin-howto-title').value = textContent.howto_title;
            if (textContent.howto_content) document.getElementById('admin-howto-content').value = textContent.howto_content;
            if (textContent.title) document.getElementById('admin-title').value = textContent.title;
            if (textContent.price_subtitle) document.getElementById('admin-price-subtitle').value = textContent.price_subtitle;
            // Desktop orange text labels - contenteditable elements
            if (textContent.panel_title) {
                const panelTitleEl = document.getElementById('admin-panel-title-preview');
                if (panelTitleEl) panelTitleEl.textContent = textContent.panel_title;
            }
            if (textContent.canvas_label) {
                const canvasLabelEl = document.getElementById('admin-canvas-label-preview');
                if (canvasLabelEl) canvasLabelEl.textContent = textContent.canvas_label;
            }
            if (textContent.section_upload) {
                const sectionUploadEl = document.getElementById('admin-section-upload');
                if (sectionUploadEl) sectionUploadEl.textContent = textContent.section_upload;
            }
            if (textContent.section_grid) {
                const sectionGridEl = document.getElementById('admin-section-grid');
                if (sectionGridEl) sectionGridEl.textContent = textContent.section_grid;
            }
            if (textContent.section_adjustments) {
                const sectionAdjustmentsEl = document.getElementById('admin-section-adjustments');
                if (sectionAdjustmentsEl) sectionAdjustmentsEl.textContent = textContent.section_adjustments;
            }
            if (textContent.section_painting) {
                const sectionPaintingEl = document.getElementById('admin-section-painting');
                if (sectionPaintingEl) sectionPaintingEl.textContent = textContent.section_painting;
            }
            // Additional editable text fields
            if (textContent.grid_btn_48) {
                const el = document.getElementById('admin-grid-btn-48');
                if (el) el.textContent = textContent.grid_btn_48;
            }
            if (textContent.grid_btn_75) {
                const el = document.getElementById('admin-grid-btn-75');
                if (el) el.textContent = textContent.grid_btn_75;
            }
            if (textContent.grid_btn_96) {
                const el = document.getElementById('admin-grid-btn-96');
                if (el) el.textContent = textContent.grid_btn_96;
            }
            if (textContent.slider_contrast_label) {
                const el = document.getElementById('admin-slider-contrast-label');
                if (el) el.textContent = textContent.slider_contrast_label;
            }
            if (textContent.slider_brightness_label) {
                const el = document.getElementById('admin-slider-brightness-label');
                if (el) el.textContent = textContent.slider_brightness_label;
            }
            if (textContent.slider_tones_label) {
                const el = document.getElementById('admin-slider-tones-label');
                if (el) el.textContent = textContent.slider_tones_label;
            }
            if (textContent.slider_denoise_label) {
                const el = document.getElementById('admin-slider-denoise-label');
                if (el) el.textContent = textContent.slider_denoise_label;
            }
            if (textContent.label_dimensions) {
                const el = document.getElementById('admin-label-dimensions');
                if (el) el.textContent = textContent.label_dimensions;
            }
            if (textContent.label_addons) {
                const el = document.getElementById('admin-label-addons');
                if (el) el.textContent = textContent.label_addons;
            }
            if (textContent.label_48x48) {
                const el = document.getElementById('admin-label-48x48');
                if (el) el.textContent = textContent.label_48x48;
            }
            if (textContent.label_75x75) {
                const el = document.getElementById('admin-label-75x75');
                if (el) el.textContent = textContent.label_75x75;
            }
            if (textContent.label_96x96) {
                const el = document.getElementById('admin-label-96x96');
                if (el) el.textContent = textContent.label_96x96;
            }
            if (textContent.stand_name) {
                const el = document.getElementById('admin-stand-name');
                if (el) el.textContent = textContent.stand_name;
            }
            if (textContent.stand_upload_btn) {
                const el = document.getElementById('admin-stand-upload-btn');
                if (el) el.textContent = textContent.stand_upload_btn;
            }
            if (textContent.mounting_name) {
                const el = document.getElementById('admin-mounting-name');
                if (el) el.textContent = textContent.mounting_name;
            }
            if (textContent.mounting_upload_btn) {
                const el = document.getElementById('admin-mounting-upload-btn');
                if (el) el.textContent = textContent.mounting_upload_btn;
            }
            if (textContent.color_black_title) {
                const el = document.getElementById('admin-color-black-title');
                if (el) el.textContent = textContent.color_black_title;
            }
            if (textContent.color_darkgray_title) {
                const el = document.getElementById('admin-color-darkgray-title');
                if (el) el.textContent = textContent.color_darkgray_title;
            }
            if (textContent.color_lightgray_title) {
                const el = document.getElementById('admin-color-lightgray-title');
                if (el) el.textContent = textContent.color_lightgray_title;
            }
            if (textContent.color_white_title) {
                const el = document.getElementById('admin-color-white-title');
                if (el) el.textContent = textContent.color_white_title;
            }
            
            // Load size guide
            if (textContent.size_guide_title) {
                const el = document.getElementById('admin-size-guide-title');
                if (el) el.value = textContent.size_guide_title;
            }
            if (textContent.size_guide_button_text) {
                const el = document.getElementById('admin-size-guide-button-text');
                if (el) el.value = textContent.size_guide_button_text;
            }
            if (textContent.size_guide) {
                if (textContent.size_guide.note) {
                    const el = document.getElementById('admin-size-guide-note');
                    if (el) el.value = textContent.size_guide.note;
                }
                populateSizeGuide('square', textContent.size_guide.square || []);
                // Portrait and landscape will be added later
                // populateSizeGuide('portrait', textContent.size_guide.portrait || []);
                // populateSizeGuide('landscape', textContent.size_guide.landscape || []);
            }
        }
        
        function populateSizeGuide(type, sizes) {
            const container = document.getElementById(`admin-size-guide-${type}`);
            if (!container) return;
            container.innerHTML = '';
            sizes.forEach((size, index) => {
                addSizeGuideItem(type, size.bricks, size.cm, index);
            });
        }
        
        // Make functions globally accessible
        window.addSizeGuideItem = function(type, bricks = '', cm = '', index = null) {
            const container = document.getElementById(`admin-size-guide-${type}`);
            if (!container) return;
            
            const div = document.createElement('div');
            div.style.display = 'flex';
            div.style.gap = '10px';
            div.style.alignItems = 'center';
            div.innerHTML = `
                <input type="text" placeholder="Bricks (e.g., 32 √ó 32 bricks)" value="${bricks}" 
                    style="flex: 1; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 12px;"
                    data-type="${type}" data-field="bricks">
                <span>=</span>
                <input type="text" placeholder="CM (e.g., 28.6 √ó 28.6 cm)" value="${cm}" 
                    style="flex: 1; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 12px;"
                    data-type="${type}" data-field="cm">
                <button onclick="window.removeSizeGuideItem(this)" style="padding: 6px 10px; background: #d32f2f; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">√ó</button>
            `;
            if (index !== null) {
                container.insertBefore(div, container.children[index]);
            } else {
                container.appendChild(div);
            }
        };
        
        window.removeSizeGuideItem = function(btn) {
            btn.parentElement.remove();
        };

        function updateImagePreviews() {
            const standImg = document.getElementById('admin-stand-image');
            if (productImages.stand) {
                standImg.src = productImages.stand;
                standImg.style.display = 'block';
            }

            const mountingImg = document.getElementById('admin-mounting-image');
            if (productImages.wall_mounting_dots) {
                mountingImg.src = productImages.wall_mounting_dots;
                mountingImg.style.display = 'block';
            }
        }

        async function uploadImage(key, file) {
            if (!file) return;
            
            const formData = new FormData();
            formData.append('image', file);
            formData.append('key', key);
            
            try {
                const response = await fetch(getApiUrl('/admin/images/api'), {
                    method: 'POST',
                    body: formData
                });
                
                // Get response text first (can only be read once)
                const responseText = await response.text();
                
                // Check if response is OK
                if (!response.ok) {
                    showStatus('error', `Error saving: Server returned ${response.status} ${response.statusText}. ${responseText.substring(0, 100)}`);
                    return;
                }
                
                // Check if response is empty
                if (!responseText || responseText.trim() === '') {
                    showStatus('error', 'Error saving: Server returned empty response. Check backend logs.');
                    return;
                }
                
                // Check content type
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    showStatus('error', `Error saving: Expected JSON but got ${contentType}. Response: ${responseText.substring(0, 200)}`);
                    return;
                }
                
                // Parse JSON
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    showStatus('error', `Error saving: Invalid JSON response. Response: ${responseText.substring(0, 200)}`);
                    return;
                }
                if (result.success) {
                    // Reload images to get the latest URLs
                    await loadImages();
                    updateImagePreviews();
                    const itemName = key === 'stand' ? 'Stand' : 'Wall Mounting Dots';
                    showStatus('success', `${itemName} image uploaded and saved successfully! It will appear on the website immediately (refresh the website page to see it).`);
                } else {
                    showStatus('error', 'Failed to upload image: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                showStatus('error', 'Error uploading image: ' + error.message);
            }
        }

        async function uploadSTL(size, file) {
            if (!file) return;
            
            const formData = new FormData();
            formData.append('stl', file);
            formData.append('size', size);
            
            const statusEl = document.getElementById(`admin-stl-status-${size}x${size}`);
            statusEl.textContent = 'Uploading...';
            
            try {
                const response = await fetch(getApiUrl('/admin/stl/api'), {
                    method: 'POST',
                    body: formData
                });
                
                // Check if response is OK and is JSON
                if (!response.ok) {
                    const text = await response.text();
                    statusEl.textContent = 'Upload failed';
                    statusEl.style.color = '#d32f2f';
                    showStatus('error', `Error saving STL: Server returned ${response.status} ${response.statusText}. ${text.substring(0, 100)}`);
                    return;
                }
                
                // Check content type
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    statusEl.textContent = 'Upload failed';
                    statusEl.style.color = '#d32f2f';
                    showStatus('error', `Error saving STL: Expected JSON but got ${contentType}. Response: ${text.substring(0, 200)}`);
                    return;
                }
                
                const result = await response.json();
                if (result.success) {
                    statusEl.textContent = 'Uploaded ‚úì';
                    statusEl.style.color = '#2d5016';
                    showStatus('success', `STL file for ${size}√ó${size} uploaded successfully!`);
                } else {
                    statusEl.textContent = 'Upload failed';
                    statusEl.style.color = '#d32f2f';
                    showStatus('error', 'Failed to upload STL: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                statusEl.textContent = 'Upload failed';
                statusEl.style.color = '#d32f2f';
                showStatus('error', 'Error uploading STL: ' + error.message);
            }
        }

        async function saveAll() {
            const btn = document.querySelector('.save-all-button');
            btn.disabled = true;
            btn.textContent = 'Saving...';

            try {
                // Verify images are saved (they should already be saved from upload, but verify)
                const imagesResponse = await fetch(getApiUrl('/admin/images/api'));
                if (!imagesResponse.ok) {
                    throw new Error(`Failed to load images: Server returned ${imagesResponse.status} ${imagesResponse.statusText}`);
                }
                const contentType = imagesResponse.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await imagesResponse.text();
                    throw new Error(`Expected JSON but got ${contentType}. Response: ${text.substring(0, 200)}`);
                }
                const currentImages = await imagesResponse.json();
                
                // Save prices
                const pricesToSave = {
                    '48x48': parseFloat(document.getElementById('admin-price-48x48').value) || 39.99,
                    '75x75': parseFloat(document.getElementById('admin-price-75x75').value) || 49.99,
                    '96x96': parseFloat(document.getElementById('admin-price-96x96').value) || 59.99,
                    stand: parseFloat(document.getElementById('admin-stand-price').value) || 10.00,
                    wall_mounting_dots: parseFloat(document.getElementById('admin-mounting-price').value) || 5.99
                };
                
                const pricesResponse = await fetch(getApiUrl('/admin/prices/api'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(pricesToSave)
                });
                
                if (!pricesResponse.ok) {
                    throw new Error(`Failed to save prices: Server returned ${pricesResponse.status} ${pricesResponse.statusText}`);
                }
                const pricesResult = await pricesResponse.json();

                // Save text content
                const panelTitleEl = document.getElementById('admin-panel-title-preview');
                const canvasLabelEl = document.getElementById('admin-canvas-label-preview');
                const sectionUploadEl = document.getElementById('admin-section-upload');
                const sectionGridEl = document.getElementById('admin-section-grid');
                const sectionAdjustmentsEl = document.getElementById('admin-section-adjustments');
                const sectionPaintingEl = document.getElementById('admin-section-painting');
                
                // Get existing STL text values from loaded content (since fields are removed from admin)
                const existingStlUploadText = textContent.stl_upload_text || 'Choose STL file...';
                const existingStlSubtext = textContent.stl_subtext || 'Or auto-load from server';
                
                const textContentToSave = {
                    title: document.getElementById('admin-title').value,
                    price_subtitle: document.getElementById('admin-price-subtitle').value,
                    upload_image_text: document.getElementById('admin-upload-text').value,
                    upload_subtext: document.getElementById('admin-upload-subtext').value,
                    // STL upload fields removed from admin panel - preserve existing values
                    stl_upload_text: existingStlUploadText,
                    stl_subtext: existingStlSubtext,
                    info_title: document.getElementById('admin-info-title').value,
                    info_description: document.getElementById('admin-info-description').value,
                    info_additional: document.getElementById('admin-info-additional').value,
                    howto_title: document.getElementById('admin-howto-title').value,
                    howto_content: document.getElementById('admin-howto-content').value,
                    // Desktop orange text labels - read from contenteditable elements
                    panel_title: panelTitleEl ? panelTitleEl.textContent.trim() : 'Edit Your Photo',
                    canvas_label: canvasLabelEl ? canvasLabelEl.textContent.trim() : 'Processed (Posterized)',
                    section_upload: sectionUploadEl ? sectionUploadEl.textContent.trim() : '1. Upload Color Image',
                    section_grid: sectionGridEl ? sectionGridEl.textContent.trim() : '2. Select Grid Size',
                    section_adjustments: sectionAdjustmentsEl ? sectionAdjustmentsEl.textContent.trim() : 'Image Adjustments',
                    section_painting: sectionPaintingEl ? sectionPaintingEl.textContent.trim() : 'Painting',
                    // Additional editable text fields
                    grid_btn_48: document.getElementById('admin-grid-btn-48') ? document.getElementById('admin-grid-btn-48').textContent.trim() : '48 √ó 48',
                    grid_btn_75: document.getElementById('admin-grid-btn-75') ? document.getElementById('admin-grid-btn-75').textContent.trim() : '75 √ó 75',
                    grid_btn_96: document.getElementById('admin-grid-btn-96') ? document.getElementById('admin-grid-btn-96').textContent.trim() : '96 √ó 96',
                    slider_contrast_label: document.getElementById('admin-slider-contrast-label') ? document.getElementById('admin-slider-contrast-label').textContent.trim() : 'Contrast',
                    slider_brightness_label: document.getElementById('admin-slider-brightness-label') ? document.getElementById('admin-slider-brightness-label').textContent.trim() : 'Brightness',
                    slider_tones_label: document.getElementById('admin-slider-tones-label') ? document.getElementById('admin-slider-tones-label').textContent.trim() : 'Tones',
                    slider_denoise_label: document.getElementById('admin-slider-denoise-label') ? document.getElementById('admin-slider-denoise-label').textContent.trim() : 'Denoise',
                    label_dimensions: document.getElementById('admin-label-dimensions') ? document.getElementById('admin-label-dimensions').textContent.trim() : 'Dimensions:',
                    label_addons: document.getElementById('admin-label-addons') ? document.getElementById('admin-label-addons').textContent.trim() : 'Addons:',
                    label_48x48: document.getElementById('admin-label-48x48') ? document.getElementById('admin-label-48x48').textContent.trim() : '48√ó48:',
                    label_75x75: document.getElementById('admin-label-75x75') ? document.getElementById('admin-label-75x75').textContent.trim() : '75√ó75:',
                    label_96x96: document.getElementById('admin-label-96x96') ? document.getElementById('admin-label-96x96').textContent.trim() : '96√ó96:',
                    stand_name: document.getElementById('admin-stand-name') ? document.getElementById('admin-stand-name').textContent.trim() : 'Stand',
                    stand_upload_btn: document.getElementById('admin-stand-upload-btn') ? document.getElementById('admin-stand-upload-btn').textContent.trim() : 'Upload Image',
                    mounting_name: document.getElementById('admin-mounting-name') ? document.getElementById('admin-mounting-name').textContent.trim() : 'Nano Wall Mounting Dots (Pack of 8)',
                    mounting_upload_btn: document.getElementById('admin-mounting-upload-btn') ? document.getElementById('admin-mounting-upload-btn').textContent.trim() : 'Upload Image',
                    color_black_title: document.getElementById('admin-color-black-title') ? document.getElementById('admin-color-black-title').textContent.trim() : 'Black',
                    color_darkgray_title: document.getElementById('admin-color-darkgray-title') ? document.getElementById('admin-color-darkgray-title').textContent.trim() : 'Dark Gray',
                    color_lightgray_title: document.getElementById('admin-color-lightgray-title') ? document.getElementById('admin-color-lightgray-title').textContent.trim() : 'Light Gray',
                    color_white_title: document.getElementById('admin-color-white-title') ? document.getElementById('admin-color-white-title').textContent.trim() : 'White',
                    size_guide_title: document.getElementById('admin-size-guide-title') ? document.getElementById('admin-size-guide-title').value.trim() : 'Size Guide',
                    size_guide_button_text: document.getElementById('admin-size-guide-button-text') ? document.getElementById('admin-size-guide-button-text').value.trim() : 'Size Guide',
                    size_guide: {
                        square: getSizeGuideItems('square'),
                        portrait: [], // Will be added later
                        landscape: [], // Will be added later
                        note: document.getElementById('admin-size-guide-note') ? document.getElementById('admin-size-guide-note').value.trim() : ''
                    }
                };
                
                function getSizeGuideItems(type) {
                    const container = document.getElementById(`admin-size-guide-${type}`);
                    if (!container) return [];
                    const items = [];
                    container.querySelectorAll('div').forEach(div => {
                        const bricksInput = div.querySelector('input[data-field="bricks"]');
                        const cmInput = div.querySelector('input[data-field="cm"]');
                        if (bricksInput && cmInput && bricksInput.value.trim() && cmInput.value.trim()) {
                            items.push({
                                bricks: bricksInput.value.trim(),
                                cm: cmInput.value.trim()
                            });
                        }
                    });
                    return items;
                }

                const contentResponse = await fetch(getApiUrl('/admin/content/api'), {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(textContentToSave)
                });
                
                if (!contentResponse.ok) {
                    const text = await contentResponse.text();
                    throw new Error(`Failed to save content: Server returned ${contentResponse.status} ${contentResponse.statusText}. ${text.substring(0, 200)}`);
                }
                const contentContentType = contentResponse.headers.get('content-type');
                if (!contentContentType || !contentContentType.includes('application/json')) {
                    const text = await contentResponse.text();
                    throw new Error(`Expected JSON but got ${contentContentType}. Response: ${text.substring(0, 200)}`);
                }

                const contentResult = await contentResponse.json();

                // Check if images exist
                const hasStandImage = currentImages.stand && currentImages.stand.length > 0;
                const hasMountingImage = currentImages.wall_mounting_dots && currentImages.wall_mounting_dots.length > 0;
                
                let imageStatus = '';
                if (!hasStandImage) {
                    imageStatus += ' Stand image not uploaded.';
                }
                if (!hasMountingImage) {
                    imageStatus += ' Wall mounting dots image not uploaded.';
                }

                if (pricesResult.success && contentResult.success) {
                    if (imageStatus) {
                        showStatus('success', 'Prices and content saved successfully!' + imageStatus);
                    } else {
                        showStatus('success', 'All changes saved successfully! Images are saved and will appear on the website.');
                    }
                } else {
                    showStatus('error', 'Some changes failed to save');
                }
            } catch (error) {
                showStatus('error', 'Error saving: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Save All';
            }
        }

        function showStatus(type, message) {
            const status = document.getElementById('status-message');
            status.className = `status-message ${type}`;
            status.textContent = message;
            setTimeout(() => {
                status.className = 'status-message';
            }, 5000);
        }

        async function checkSTLStatus() {
            try {
                const response = await fetch(getApiUrl('/admin/stl/api'));
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status} ${response.statusText}`);
                }
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    throw new Error(`Expected JSON but got ${contentType}. Response: ${text.substring(0, 200)}`);
                }
                const statuses = await response.json();
                for (const size of [48, 75, 96]) {
                    const statusEl = document.getElementById(`admin-stl-status-${size}x${size}`);
                    if (statuses[`${size}x${size}`]) {
                        statusEl.textContent = 'File exists ‚úì';
                        statusEl.style.color = '#2d5016';
                    }
                }
            } catch (error) {
                console.error('Failed to check STL status:', error);
            }
        }

        // Sync main price with 75x75
        document.getElementById('admin-price-75x75').addEventListener('input', function() {
            document.getElementById('admin-main-price').value = this.value;
        });

        document.getElementById('admin-main-price').addEventListener('input', function() {
            document.getElementById('admin-price-75x75').value = this.value;
        });

        // Color editor functionality
        function selectAdminPaintColor(r, g, b, element) {
            // Remove selected class from all swatches
            document.querySelectorAll('.color-swatch').forEach(swatch => {
                swatch.classList.remove('selected');
            });
            // Add selected class to clicked swatch
            if (element) {
                element.classList.add('selected');
            }
        }

        function setupColorEditor() {
            // Add click handlers to color swatches (but not on the labels)
            document.querySelectorAll('.color-swatch').forEach(swatch => {
                swatch.addEventListener('click', function(e) {
                    // Don't trigger if clicking on the label
                    if (e.target.tagName === 'SPAN') return;
                    const colorData = this.getAttribute('data-color');
                    if (colorData) {
                        const [r, g, b] = colorData.split(',').map(Number);
                        selectAdminPaintColor(r, g, b, this);
                    }
                });
            });
            
            // Prevent button clicks from triggering when editing contenteditable buttons
            document.querySelectorAll('button[contenteditable="true"]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    // If clicking on the button text (not already focused), allow editing
                    if (document.activeElement !== this) {
                        e.preventDefault();
                        this.focus();
                    }
                });
            });
        }

        // Load on page load
        window.addEventListener('load', async () => {
            await loadPrices();
            await loadImages();
            await loadTextContent();
            await loadVariantIds();  // Load Shopify variant IDs
            await checkSTLStatus();
            // Setup color editor after content is loaded
            setupColorEditor();
        });
    </script>
</body>
</html>
